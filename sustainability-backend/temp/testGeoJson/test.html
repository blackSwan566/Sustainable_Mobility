<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Traffic Route Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      #map {
        height: 100vh;
        width: 100vw;
      }
      .popup-content {
        font-family: Arial, sans-serif;
        font-size: 12px;
      }
      .popup-content table {
        border-collapse: collapse;
      }
      .popup-content td {
        padding: 2px 5px;
        border-bottom: 1px solid #eee;
      }
      .popup-content td:first-child {
        font-weight: bold;
        color: #666;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
      const map = L.map("map").setView([48.13, 11.56], 13);

      // Use CartoDB's Positron style for minimal black and white look
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
        {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
          subdomains: "abcd",
          maxZoom: 19,
        }
      ).addTo(map);

      function createPopup(properties) {
        let html = '<div class="popup-content"><table>';
        for (const [key, value] of Object.entries(properties)) {
          if (value !== null && value !== "") {
            html += `<tr><td>${key}</td><td>${value}</td></tr>`;
          }
        }
        return html + "</table></div>";
      }

      // Color mapping for different edge types
      const edgeTypeColors = {
        "highway.primary": "#ff4444",
        "highway.primary_link": "#ff4444",
        "highway.secondary": "#44ff44",
        "highway.secondary_link": "#44ff44",
        "highway.tertiary": "#4444ff",
        "highway.tertiary_link": "#4444ff",
        "highway.residential": "#ffaa44",
        "highway.residential_link": "#ffaa44",
        "highway.service": "#44ffff",
        "highway.pedestrian": "#ff44ff",
        "highway.cycleway": "#88ff88",
        "highway.path": "#888888",
        "highway.unclassified": "#aaaaaa",
      };

      function getColorByEdgeType(feature) {
        const edgeType = feature.properties.edge_type || "highway.unclassified";
        return edgeTypeColors[edgeType] || "#aaaaaa"; // Default gray for unknown types
      }

      fetch("../../output/final2.geojson")
        .then((response) => response.json())
        .then((data) => {
          const layer = L.geoJSON(data, {
            style: (feature) => ({
              color: getColorByEdgeType(feature),
              weight: 4,
              opacity: 1,
            }),
            onEachFeature: (feature, layer) => {
              layer.bindPopup(createPopup(feature.properties), {
                closeButton: false,
              });
              layer.on("mouseover", () => layer.openPopup());
              layer.on("mouseout", () => layer.closePopup());
            },
          }).addTo(map);

          map.fitBounds(layer.getBounds(), { padding: [50, 50] });
        })
        .catch((error) => console.error("Error loading data:", error));
    </script>
  </body>
</html>
